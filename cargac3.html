<!DOCTYPE html>
<html lang="es">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Carga EV</title>

<style>
body {
    font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, Arial;
    background: #f2f2f7;
    margin: 0;
    padding: 16px;
}

.card {
    background: white;
    border-radius: 16px;
    padding: 20px;
    box-shadow: 0 4px 12px rgba(0,0,0,0.1);
}

h1, h2 {
    text-align: center;
}

label {
    font-size: 14px;
    font-weight: 600;
    margin-top: 14px;
    display: block;
}

input {
    width: 100%;
    font-size: 18px;
    padding: 12px;
    margin-top: 6px;
    border-radius: 10px;
    border: 1px solid #ccc;
}

button {
    width: 100%;
    margin-top: 18px;
    padding: 14px;
    font-size: 17px;
    font-weight: bold;
    border-radius: 14px;
    border: none;
}

.calcular { background: #007aff; color: white; }
.guardar { background: #34c759; color: white; }
.borrar { background: #ff3b30; color: white; }

.resultado, .historial {
    margin-top: 20px;
    background: #eef1f6;
    padding: 14px;
    border-radius: 12px;
}

.dato {
    font-size: 20px;
    font-weight: bold;
}
</style>
</head>

<body>

<div class="card">
<h1>üîã Carga EV</h1>

<label>Bater√≠a actual (%)</label>
<input id="actual" type="number" value="70">

<label>Bater√≠a objetivo (%)</label>
<input id="objetivo" type="number" value="85">

<label>Amperios de carga</label>
<input id="amperios" type="number" value="8">

<button class="calcular" onclick="calcular()">Calcular</button>

<div class="resultado" id="resultado"></div>

<button class="guardar" onclick="guardar()">Guardar carga</button>

<h2>üìä Mes actual</h2>
<div class="historial" id="historial"></div>

<button class="borrar" onclick="borrar()">Borrar historial</button>
</div>

<script>
let ultimaCarga = null;

function calcular() {
    const bateria = 44;
    const voltaje = 230;
    const precio = 0.1270 * 1.21;

    const a = Number(actual.value);
    const o = Number(objetivo.value);
    const amp = Number(amperios.value);

    let kwh = 0;
    for (let p = a; p < o; p++) {
        let f = p >= 80 ? 0.85 : 1;
        kwh += (bateria / 100) / f;
    }

    const potencia = voltaje * amp / 1000;
    const horas = kwh / potencia;
    const coste = kwh * precio;

    ultimaCarga = { kwh, coste };

    const fin = new Date(Date.now() + horas * 3600000);
    const hora = fin.toLocaleTimeString("es-ES", {hour:"2-digit",minute:"2-digit"});

    resultado.innerHTML = `
    ‚è± <b>${horas.toFixed(2)} h</b><br>
    ‚ö° <b>${kwh.toFixed(2)} kWh</b><br>
    üí∂ <b>${coste.toFixed(2)} ‚Ç¨</b><br>
    üïí <b>${hora}</b>`;
}

function guardar() {
    if (!ultimaCarga) return;

    const data = JSON.parse(localStorage.getItem("cargas") || "[]");

    data.push({
        fecha: new Date().toISOString(),
        kwh: ultimaCarga.kwh,
        coste: ultimaCarga.coste
    });

    localStorage.setItem("cargas", JSON.stringify(data));
    mostrar();
}

function mostrar() {
    const data = JSON.parse(localStorage.getItem("cargas") || "[]");
    const ahora = new Date();
    let total = 0;

    const mes = data.filter(c => {
        const f = new Date(c.fecha);
        return f.getMonth() === ahora.getMonth() &&
               f.getFullYear() === ahora.getFullYear();
    });

    let html = "";
    mes.forEach(c => {
        total += c.coste;
        html += `‚Ä¢ ${new Date(c.fecha).toLocaleDateString()} ‚Üí ${c.coste.toFixed(2)} ‚Ç¨<br>`;
    });

    html += `<br><b>Total mes: ${total.toFixed(2)} ‚Ç¨</b>`;
    historial.innerHTML = html || "Sin registros";
}

function borrar() {
    if (confirm("¬øBorrar todas las cargas?")) {
        localStorage.removeItem("cargas");
        mostrar();
    }
}

mostrar();
</script>

</body>
</html>